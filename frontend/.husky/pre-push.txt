#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸš€ Running frontend pre-push checks..."

# Bash attempt
bash -c '
  echo "ğŸ” Running frontend type check..."
  cd frontend && pnpm tsc --noEmit || exit 1

  echo "ğŸ§¹ Running frontend lint check..."
  pnpm eslint --ext .ts,.tsx . || exit 1

  echo "ğŸ§ª Running frontend tests..."
  pnpm test || exit 1
' || {
  if [ "$OS" = "Windows_NT" ]; then
    echo "âš ï¸ Bash failed, falling back to PowerShell..."

    pwsh -Command '
      Write-Host "ğŸ” Running frontend type check..."
      Set-Location frontend
      pnpm tsc --noEmit
      if ($LASTEXITCODE -ne 0) { exit 1 }

      Write-Host "ğŸ§¹ Running frontend lint check..."
      pnpm eslint --ext .ts,.tsx .
      if ($LASTEXITCODE -ne 0) { exit 1 }

      Write-Host "ğŸ§ª Running frontend tests..."
      pnpm test
      if ($LASTEXITCODE -ne 0) { exit 1 }
    ' || {
      echo "âŒ Push aborted: Frontend pre-push checks failed."
      exit 1
    }
  else
    echo "âŒ Push aborted: Bash failed and no PowerShell fallback available."
    exit 1
  fi
}

echo "âœ… Frontend pre-push checks passed."
